<div>
  <app-nav></app-nav>
  <div class="app-content">
    <div class="checkbox">
        <label><input type="checkbox" [(ngModel)]="showAll">Show All Transactions</label>
        <span style="font-size:large; float:right; margin-right:20px;">Total Gain:  <ed-colored-text [num]="getGrandTotalGain()"></ed-colored-text></span>
    </div>
    <table class="table table-hovered table-center">
      <thead>
        <tr>
          <th></th>
          <th [ngClass]="{'sorted':sCol == 'name'}" (click)="sortData('name')">{{getTitle('name')}}</th>
          <th [ngClass]="{'sorted':sCol == 'symbol'}" (click)="sortData('symbol')">{{getTitle('symbol')}}</th>
          <th [ngClass]="{'sorted':sCol == 'shares'}" (click)="sortData('shares')" class="right">{{getTitle('shares')}}</th>
          <th [ngClass]="{'sorted':sCol == 'avgcost'}" (click)="sortData('avgcost')" class="right">{{getTitle('avgcost')}}</th>
          <th [ngClass]="{'sorted':sCol == 'quote'}" (click)="sortData('quote')"  class="right">{{getTitle('quote')}}</th>
          <th [ngClass]="{'sorted':sCol == 'daychange'}" (click)="sortData('daychange')"  class="right">{{getTitle('daychange')}}</th>
          <th [ngClass]="{'sorted':sCol == 'daychangeper'}" (click)="sortData('daychangeper')" class="right">{{getTitle('daychangeper')}}</th>
          <th [ngClass]="{'sorted':sCol == 'mktval'}" (click)="sortData('mktval')" class="right">{{getTitle('mktval')}}</th>
          <th [ngClass]="{'sorted':sCol == 'totgain'}" (click)="sortData('totgain')" class="right">{{getTitle('totgain')}}</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let p of positions;let i = index">
          <tr>
            <td>{{i+1}}</td>
            <td>{{ p.name }}</td>
            <td>{{ p.symbol }}</td>
            <td  class="right">{{ getSum(p.transactions) }} </td>
            <td class="right">{{ getAvg(p.transactions) }} </td>
            <td class="right">{{ p.quote | number:'1.2-2'}}</td>
            <td class="right"><ed-colored-text [num]="(p.quote-p.adjusted_previous_close)"></ed-colored-text></td>
            <td class="right"><ed-colored-text [num]="((p.quote-p.adjusted_previous_close)/p.adjusted_previous_close)*100 "></ed-colored-text></td>
            <td class="right">{{ (p.quote*getSum(p.transactions)) | number:'1.2-2' }}</td>
            <td class="right"><ed-colored-text [num]="getTotalGain(p)"></ed-colored-text></td></tr>
          <ng-container *ngIf="p.transactions.length > 1 && showAll">
            <tr *ngFor="let t of p.transactions">
              <td></td>
              <td></td>
              <td></td>
              <td class="right">{{ t.shares }} </td>
              <td class="right">{{ t.price }}</td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
      <tfoot>
        <tr>
          <th colspan=10 class="right">{{getGrandTotalGain()| number:'1.2-2' }}</th>
        </tr>
      </tfoot>
    </table>
    <br>
    <button type="button" class="btn btn-danger" (click)="removeAll()">CLear Local Storage</button>
    <button type="button" class="btn btn-success" (click)="SaveAsFile()">Save</button>
    <br>
    <br>
    <br>
    <div class="form-inline">
      <input [(ngModel)]="newTransaction.name" placeholder="Name" class="form-control">
      <input [(ngModel)]="newTransaction.symbol" placeholder="Symbol" class="form-control">
      <input [(ngModel)]="newTransaction.shares" class="form-control" placeholder="Shares">
      <input [(ngModel)]="newTransaction.price" class="form-control" placeholder="Purchase Price" (keyup.enter)="addTransaction(newTransaction)">
      <button type="button" class="btn btn-primary" (click)="addTransaction(newTransaction)">Add</button>
    </div>
    <br/>
    <div class="form-inline">
      <textarea class="form-control" rows="5" placeholder="Import CVS" [(ngModel)]="importText"></textarea>
      <button type="button" class="btn btn-warning" (click)="importTransactions()">Import CVS</button>
      <textarea class="form-control" rows="5" placeholder="Import Json" [(ngModel)]="importJson"></textarea>
      <button type="button" class="btn btn-warning" (click)="importJsonTrans()">Import JSON</button>
    </div>
    <br/>
    
  </div>
</div>